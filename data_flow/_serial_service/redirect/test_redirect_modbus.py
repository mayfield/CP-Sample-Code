__author__ = 'Lynn'

"""
This script sends 256 binary Modbus request via IP through a Cradlepoint "Serial Redirector". It expects to see the
same (or appropriately LineFeed modified) request via serial port. It then returns a valid Modbus reply.

The 256 messages are to confirm which bytes (if any) are modified by the "Serial Redirector". Obviously, if for
example a 0x0A is changed to 0x0D, then the Modbus CRC16 will be wrong, but this script is NOT testing for that.
It is merely testing for a bytearray match.

To use, fill in the details below (Router IP, etc). This script does NOT change the Router settings; you must do that
externally by any means you prefer.
"""

# The target IP and TCP port of the router under test
ROUTER_IP = "192.168.0.208"
ROUTER_PORT = 7218

# the serial port name linked to Router's serial (pyserial style)
SERIAL_PORT = "COM5"

# set to 'CR', 'NL', 'CR/LF', or None (for ignore).
LINE_FEED = None
assert LINE_FEED in ('CR', 'NL', 'CR/LF', None)


REQ_DATA = [
    b"\x01\x03\x00\x00\x00\x01\x84\x0A",
    b"\x01\x03\x00\x01\x00\x01\xD5\xCA",
    b"\x01\x03\x00\x02\x00\x01\x25\xCA",
    b"\x01\x03\x00\x03\x00\x01\x74\x0A",
    b"\x01\x03\x00\x04\x00\x01\xC5\xCB",
    b"\x01\x03\x00\x05\x00\x01\x94\x0B",
    b"\x01\x03\x00\x06\x00\x01\x64\x0B",
    b"\x01\x03\x00\x07\x00\x01\x35\xCB",
    b"\x01\x03\x00\x08\x00\x01\x05\xC8",
    b"\x01\x03\x00\x09\x00\x01\x54\x08",
    b"\x01\x03\x00\x0A\x00\x01\xA4\x08",
    b"\x01\x03\x00\x0B\x00\x01\xF5\xC8",
    b"\x01\x03\x00\x0C\x00\x01\x44\x09",
    b"\x01\x03\x00\x0D\x00\x01\x15\xC9",
    b"\x01\x03\x00\x0E\x00\x01\xE5\xC9",
    b"\x01\x03\x00\x0F\x00\x01\xB4\x09",
    b"\x01\x03\x00\x10\x00\x01\x85\xCF",
    b"\x01\x03\x00\x11\x00\x01\xD4\x0F",
    b"\x01\x03\x00\x12\x00\x01\x24\x0F",
    b"\x01\x03\x00\x13\x00\x01\x75\xCF",
    b"\x01\x03\x00\x14\x00\x01\xC4\x0E",
    b"\x01\x03\x00\x15\x00\x01\x95\xCE",
    b"\x01\x03\x00\x16\x00\x01\x65\xCE",
    b"\x01\x03\x00\x17\x00\x01\x34\x0E",
    b"\x01\x03\x00\x18\x00\x01\x04\x0D",
    b"\x01\x03\x00\x19\x00\x01\x55\xCD",
    b"\x01\x03\x00\x1A\x00\x01\xA5\xCD",
    b"\x01\x03\x00\x1B\x00\x01\xF4\x0D",
    b"\x01\x03\x00\x1C\x00\x01\x45\xCC",
    b"\x01\x03\x00\x1D\x00\x01\x14\x0C",
    b"\x01\x03\x00\x1E\x00\x01\xE4\x0C",
    b"\x01\x03\x00\x1F\x00\x01\xB5\xCC",
    b"\x01\x03\x00\x20\x00\x01\x85\xC0",
    b"\x01\x03\x00\x21\x00\x01\xD4\x00",
    b"\x01\x03\x00\x22\x00\x01\x24\x00",
    b"\x01\x03\x00\x23\x00\x01\x75\xC0",
    b"\x01\x03\x00\x24\x00\x01\xC4\x01",
    b"\x01\x03\x00\x25\x00\x01\x95\xC1",
    b"\x01\x03\x00\x26\x00\x01\x65\xC1",
    b"\x01\x03\x00\x27\x00\x01\x34\x01",
    b"\x01\x03\x00\x28\x00\x01\x04\x02",
    b"\x01\x03\x00\x29\x00\x01\x55\xC2",
    b"\x01\x03\x00\x2A\x00\x01\xA5\xC2",
    b"\x01\x03\x00\x2B\x00\x01\xF4\x02",
    b"\x01\x03\x00\x2C\x00\x01\x45\xC3",
    b"\x01\x03\x00\x2D\x00\x01\x14\x03",
    b"\x01\x03\x00\x2E\x00\x01\xE4\x03",
    b"\x01\x03\x00\x2F\x00\x01\xB5\xC3",
    b"\x01\x03\x00\x30\x00\x01\x84\x05",
    b"\x01\x03\x00\x31\x00\x01\xD5\xC5",
    b"\x01\x03\x00\x32\x00\x01\x25\xC5",
    b"\x01\x03\x00\x33\x00\x01\x74\x05",
    b"\x01\x03\x00\x34\x00\x01\xC5\xC4",
    b"\x01\x03\x00\x35\x00\x01\x94\x04",
    b"\x01\x03\x00\x36\x00\x01\x64\x04",
    b"\x01\x03\x00\x37\x00\x01\x35\xC4",
    b"\x01\x03\x00\x38\x00\x01\x05\xC7",
    b"\x01\x03\x00\x39\x00\x01\x54\x07",
    b"\x01\x03\x00\x3A\x00\x01\xA4\x07",
    b"\x01\x03\x00\x3B\x00\x01\xF5\xC7",
    b"\x01\x03\x00\x3C\x00\x01\x44\x06",
    b"\x01\x03\x00\x3D\x00\x01\x15\xC6",
    b"\x01\x03\x00\x3E\x00\x01\xE5\xC6",
    b"\x01\x03\x00\x3F\x00\x01\xB4\x06",
    b"\x01\x03\x00\x40\x00\x01\x85\xDE",
    b"\x01\x03\x00\x41\x00\x01\xD4\x1E",
    b"\x01\x03\x00\x42\x00\x01\x24\x1E",
    b"\x01\x03\x00\x43\x00\x01\x75\xDE",
    b"\x01\x03\x00\x44\x00\x01\xC4\x1F",
    b"\x01\x03\x00\x45\x00\x01\x95\xDF",
    b"\x01\x03\x00\x46\x00\x01\x65\xDF",
    b"\x01\x03\x00\x47\x00\x01\x34\x1F",
    b"\x01\x03\x00\x48\x00\x01\x04\x1C",
    b"\x01\x03\x00\x49\x00\x01\x55\xDC",
    b"\x01\x03\x00\x4A\x00\x01\xA5\xDC",
    b"\x01\x03\x00\x4B\x00\x01\xF4\x1C",
    b"\x01\x03\x00\x4C\x00\x01\x45\xDD",
    b"\x01\x03\x00\x4D\x00\x01\x14\x1D",
    b"\x01\x03\x00\x4E\x00\x01\xE4\x1D",
    b"\x01\x03\x00\x4F\x00\x01\xB5\xDD",
    b"\x01\x03\x00\x50\x00\x01\x84\x1B",
    b"\x01\x03\x00\x51\x00\x01\xD5\xDB",
    b"\x01\x03\x00\x52\x00\x01\x25\xDB",
    b"\x01\x03\x00\x53\x00\x01\x74\x1B",
    b"\x01\x03\x00\x54\x00\x01\xC5\xDA",
    b"\x01\x03\x00\x55\x00\x01\x94\x1A",
    b"\x01\x03\x00\x56\x00\x01\x64\x1A",
    b"\x01\x03\x00\x57\x00\x01\x35\xDA",
    b"\x01\x03\x00\x58\x00\x01\x05\xD9",
    b"\x01\x03\x00\x59\x00\x01\x54\x19",
    b"\x01\x03\x00\x5A\x00\x01\xA4\x19",
    b"\x01\x03\x00\x5B\x00\x01\xF5\xD9",
    b"\x01\x03\x00\x5C\x00\x01\x44\x18",
    b"\x01\x03\x00\x5D\x00\x01\x15\xD8",
    b"\x01\x03\x00\x5E\x00\x01\xE5\xD8",
    b"\x01\x03\x00\x5F\x00\x01\xB4\x18",
    b"\x01\x03\x00\x60\x00\x01\x84\x14",
    b"\x01\x03\x00\x61\x00\x01\xD5\xD4",
    b"\x01\x03\x00\x62\x00\x01\x25\xD4",
    b"\x01\x03\x00\x63\x00\x01\x74\x14",
    b"\x01\x03\x00\x64\x00\x01\xC5\xD5",
    b"\x01\x03\x00\x65\x00\x01\x94\x15",
    b"\x01\x03\x00\x66\x00\x01\x64\x15",
    b"\x01\x03\x00\x67\x00\x01\x35\xD5",
    b"\x01\x03\x00\x68\x00\x01\x05\xD6",
    b"\x01\x03\x00\x69\x00\x01\x54\x16",
    b"\x01\x03\x00\x6A\x00\x01\xA4\x16",
    b"\x01\x03\x00\x6B\x00\x01\xF5\xD6",
    b"\x01\x03\x00\x6C\x00\x01\x44\x17",
    b"\x01\x03\x00\x6D\x00\x01\x15\xD7",
    b"\x01\x03\x00\x6E\x00\x01\xE5\xD7",
    b"\x01\x03\x00\x6F\x00\x01\xB4\x17",
    b"\x01\x03\x00\x70\x00\x01\x85\xD1",
    b"\x01\x03\x00\x71\x00\x01\xD4\x11",
    b"\x01\x03\x00\x72\x00\x01\x24\x11",
    b"\x01\x03\x00\x73\x00\x01\x75\xD1",
    b"\x01\x03\x00\x74\x00\x01\xC4\x10",
    b"\x01\x03\x00\x75\x00\x01\x95\xD0",
    b"\x01\x03\x00\x76\x00\x01\x65\xD0",
    b"\x01\x03\x00\x77\x00\x01\x34\x10",
    b"\x01\x03\x00\x78\x00\x01\x04\x13",
    b"\x01\x03\x00\x79\x00\x01\x55\xD3",
    b"\x01\x03\x00\x7A\x00\x01\xA5\xD3",
    b"\x01\x03\x00\x7B\x00\x01\xF4\x13",
    b"\x01\x03\x00\x7C\x00\x01\x45\xD2",
    b"\x01\x03\x00\x7D\x00\x01\x14\x12",
    b"\x01\x03\x00\x7E\x00\x01\xE4\x12",
    b"\x01\x03\x00\x7F\x00\x01\xB5\xD2",
    b"\x01\x03\x00\x80\x00\x01\x85\xE2",
    b"\x01\x03\x00\x81\x00\x01\xD4\x22",
    b"\x01\x03\x00\x82\x00\x01\x24\x22",
    b"\x01\x03\x00\x83\x00\x01\x75\xE2",
    b"\x01\x03\x00\x84\x00\x01\xC4\x23",
    b"\x01\x03\x00\x85\x00\x01\x95\xE3",
    b"\x01\x03\x00\x86\x00\x01\x65\xE3",
    b"\x01\x03\x00\x87\x00\x01\x34\x23",
    b"\x01\x03\x00\x88\x00\x01\x04\x20",
    b"\x01\x03\x00\x89\x00\x01\x55\xE0",
    b"\x01\x03\x00\x8A\x00\x01\xA5\xE0",
    b"\x01\x03\x00\x8B\x00\x01\xF4\x20",
    b"\x01\x03\x00\x8C\x00\x01\x45\xE1",
    b"\x01\x03\x00\x8D\x00\x01\x14\x21",
    b"\x01\x03\x00\x8E\x00\x01\xE4\x21",
    b"\x01\x03\x00\x8F\x00\x01\xB5\xE1",
    b"\x01\x03\x00\x90\x00\x01\x84\x27",
    b"\x01\x03\x00\x91\x00\x01\xD5\xE7",
    b"\x01\x03\x00\x92\x00\x01\x25\xE7",
    b"\x01\x03\x00\x93\x00\x01\x74\x27",
    b"\x01\x03\x00\x94\x00\x01\xC5\xE6",
    b"\x01\x03\x00\x95\x00\x01\x94\x26",
    b"\x01\x03\x00\x96\x00\x01\x64\x26",
    b"\x01\x03\x00\x97\x00\x01\x35\xE6",
    b"\x01\x03\x00\x98\x00\x01\x05\xE5",
    b"\x01\x03\x00\x99\x00\x01\x54\x25",
    b"\x01\x03\x00\x9A\x00\x01\xA4\x25",
    b"\x01\x03\x00\x9B\x00\x01\xF5\xE5",
    b"\x01\x03\x00\x9C\x00\x01\x44\x24",
    b"\x01\x03\x00\x9D\x00\x01\x15\xE4",
    b"\x01\x03\x00\x9E\x00\x01\xE5\xE4",
    b"\x01\x03\x00\x9F\x00\x01\xB4\x24",
    b"\x01\x03\x00\xA0\x00\x01\x84\x28",
    b"\x01\x03\x00\xA1\x00\x01\xD5\xE8",
    b"\x01\x03\x00\xA2\x00\x01\x25\xE8",
    b"\x01\x03\x00\xA3\x00\x01\x74\x28",
    b"\x01\x03\x00\xA4\x00\x01\xC5\xE9",
    b"\x01\x03\x00\xA5\x00\x01\x94\x29",
    b"\x01\x03\x00\xA6\x00\x01\x64\x29",
    b"\x01\x03\x00\xA7\x00\x01\x35\xE9",
    b"\x01\x03\x00\xA8\x00\x01\x05\xEA",
    b"\x01\x03\x00\xA9\x00\x01\x54\x2A",
    b"\x01\x03\x00\xAA\x00\x01\xA4\x2A",
    b"\x01\x03\x00\xAB\x00\x01\xF5\xEA",
    b"\x01\x03\x00\xAC\x00\x01\x44\x2B",
    b"\x01\x03\x00\xAD\x00\x01\x15\xEB",
    b"\x01\x03\x00\xAE\x00\x01\xE5\xEB",
    b"\x01\x03\x00\xAF\x00\x01\xB4\x2B",
    b"\x01\x03\x00\xB0\x00\x01\x85\xED",
    b"\x01\x03\x00\xB1\x00\x01\xD4\x2D",
    b"\x01\x03\x00\xB2\x00\x01\x24\x2D",
    b"\x01\x03\x00\xB3\x00\x01\x75\xED",
    b"\x01\x03\x00\xB4\x00\x01\xC4\x2C",
    b"\x01\x03\x00\xB5\x00\x01\x95\xEC",
    b"\x01\x03\x00\xB6\x00\x01\x65\xEC",
    b"\x01\x03\x00\xB7\x00\x01\x34\x2C",
    b"\x01\x03\x00\xB8\x00\x01\x04\x2F",
    b"\x01\x03\x00\xB9\x00\x01\x55\xEF",
    b"\x01\x03\x00\xBA\x00\x01\xA5\xEF",
    b"\x01\x03\x00\xBB\x00\x01\xF4\x2F",
    b"\x01\x03\x00\xBC\x00\x01\x45\xEE",
    b"\x01\x03\x00\xBD\x00\x01\x14\x2E",
    b"\x01\x03\x00\xBE\x00\x01\xE4\x2E",
    b"\x01\x03\x00\xBF\x00\x01\xB5\xEE",
    b"\x01\x03\x00\xC0\x00\x01\x84\x36",
    b"\x01\x03\x00\xC1\x00\x01\xD5\xF6",
    b"\x01\x03\x00\xC2\x00\x01\x25\xF6",
    b"\x01\x03\x00\xC3\x00\x01\x74\x36",
    b"\x01\x03\x00\xC4\x00\x01\xC5\xF7",
    b"\x01\x03\x00\xC5\x00\x01\x94\x37",
    b"\x01\x03\x00\xC6\x00\x01\x64\x37",
    b"\x01\x03\x00\xC7\x00\x01\x35\xF7",
    b"\x01\x03\x00\xC8\x00\x01\x05\xF4",
    b"\x01\x03\x00\xC9\x00\x01\x54\x34",
    b"\x01\x03\x00\xCA\x00\x01\xA4\x34",
    b"\x01\x03\x00\xCB\x00\x01\xF5\xF4",
    b"\x01\x03\x00\xCC\x00\x01\x44\x35",
    b"\x01\x03\x00\xCD\x00\x01\x15\xF5",
    b"\x01\x03\x00\xCE\x00\x01\xE5\xF5",
    b"\x01\x03\x00\xCF\x00\x01\xB4\x35",
    b"\x01\x03\x00\xD0\x00\x01\x85\xF3",
    b"\x01\x03\x00\xD1\x00\x01\xD4\x33",
    b"\x01\x03\x00\xD2\x00\x01\x24\x33",
    b"\x01\x03\x00\xD3\x00\x01\x75\xF3",
    b"\x01\x03\x00\xD4\x00\x01\xC4\x32",
    b"\x01\x03\x00\xD5\x00\x01\x95\xF2",
    b"\x01\x03\x00\xD6\x00\x01\x65\xF2",
    b"\x01\x03\x00\xD7\x00\x01\x34\x32",
    b"\x01\x03\x00\xD8\x00\x01\x04\x31",
    b"\x01\x03\x00\xD9\x00\x01\x55\xF1",
    b"\x01\x03\x00\xDA\x00\x01\xA5\xF1",
    b"\x01\x03\x00\xDB\x00\x01\xF4\x31",
    b"\x01\x03\x00\xDC\x00\x01\x45\xF0",
    b"\x01\x03\x00\xDD\x00\x01\x14\x30",
    b"\x01\x03\x00\xDE\x00\x01\xE4\x30",
    b"\x01\x03\x00\xDF\x00\x01\xB5\xF0",
    b"\x01\x03\x00\xE0\x00\x01\x85\xFC",
    b"\x01\x03\x00\xE1\x00\x01\xD4\x3C",
    b"\x01\x03\x00\xE2\x00\x01\x24\x3C",
    b"\x01\x03\x00\xE3\x00\x01\x75\xFC",
    b"\x01\x03\x00\xE4\x00\x01\xC4\x3D",
    b"\x01\x03\x00\xE5\x00\x01\x95\xFD",
    b"\x01\x03\x00\xE6\x00\x01\x65\xFD",
    b"\x01\x03\x00\xE7\x00\x01\x34\x3D",
    b"\x01\x03\x00\xE8\x00\x01\x04\x3E",
    b"\x01\x03\x00\xE9\x00\x01\x55\xFE",
    b"\x01\x03\x00\xEA\x00\x01\xA5\xFE",
    b"\x01\x03\x00\xEB\x00\x01\xF4\x3E",
    b"\x01\x03\x00\xEC\x00\x01\x45\xFF",
    b"\x01\x03\x00\xED\x00\x01\x14\x3F",
    b"\x01\x03\x00\xEE\x00\x01\xE4\x3F",
    b"\x01\x03\x00\xEF\x00\x01\xB5\xFF",
    b"\x01\x03\x00\xF0\x00\x01\x84\x39",
    b"\x01\x03\x00\xF1\x00\x01\xD5\xF9",
    b"\x01\x03\x00\xF2\x00\x01\x25\xF9",
    b"\x01\x03\x00\xF3\x00\x01\x74\x39",
    b"\x01\x03\x00\xF4\x00\x01\xC5\xF8",
    b"\x01\x03\x00\xF5\x00\x01\x94\x38",
    b"\x01\x03\x00\xF6\x00\x01\x64\x38",
    b"\x01\x03\x00\xF7\x00\x01\x35\xF8",
    b"\x01\x03\x00\xF8\x00\x01\x05\xFB",
    b"\x01\x03\x00\xF9\x00\x01\x54\x3B",
    b"\x01\x03\x00\xFA\x00\x01\xA4\x3B",
    b"\x01\x03\x00\xFB\x00\x01\xF5\xFB",
    b"\x01\x03\x00\xFC\x00\x01\x44\x3A",
    b"\x01\x03\x00\xFD\x00\x01\x15\xFA",
    b"\x01\x03\x00\xFE\x00\x01\xE5\xFA",
    b"\x01\x03\x00\xFF\x00\x01\xB4\x3A",
]

RSP_DATA = [
    b"\x01\x03\x02\x00\x00\xB8\x44",
    b"\x01\x03\x02\x01\x01\x78\x14",
    b"\x01\x03\x02\x02\x02\x38\xE5",
    b"\x01\x03\x02\x03\x03\xF8\xB5",
    b"\x01\x03\x02\x04\x04\xBB\x47",
    b"\x01\x03\x02\x05\x05\x7B\x17",
    b"\x01\x03\x02\x06\x06\x3B\xE6",
    b"\x01\x03\x02\x07\x07\xFB\xB6",
    b"\x01\x03\x02\x08\x08\xBE\x42",
    b"\x01\x03\x02\x09\x09\x7E\x12",
    b"\x01\x03\x02\x0A\x0A\x3E\xE3",
    b"\x01\x03\x02\x0B\x0B\xFE\xB3",
    b"\x01\x03\x02\x0C\x0C\xBD\x41",
    b"\x01\x03\x02\x0D\x0D\x7D\x11",
    b"\x01\x03\x02\x0E\x0E\x3D\xE0",
    b"\x01\x03\x02\x0F\x0F\xFD\xB0",
    b"\x01\x03\x02\x10\x10\xB4\x48",
    b"\x01\x03\x02\x11\x11\x74\x18",
    b"\x01\x03\x02\x12\x12\x34\xE9",
    b"\x01\x03\x02\x13\x13\xF4\xB9",
    b"\x01\x03\x02\x14\x14\xB7\x4B",
    b"\x01\x03\x02\x15\x15\x77\x1B",
    b"\x01\x03\x02\x16\x16\x37\xEA",
    b"\x01\x03\x02\x17\x17\xF7\xBA",
    b"\x01\x03\x02\x18\x18\xB2\x4E",
    b"\x01\x03\x02\x19\x19\x72\x1E",
    b"\x01\x03\x02\x1A\x1A\x32\xEF",
    b"\x01\x03\x02\x1B\x1B\xF2\xBF",
    b"\x01\x03\x02\x1C\x1C\xB1\x4D",
    b"\x01\x03\x02\x1D\x1D\x71\x1D",
    b"\x01\x03\x02\x1E\x1E\x31\xEC",
    b"\x01\x03\x02\x1F\x1F\xF1\xBC",
    b"\x01\x03\x02\x20\x20\xA0\x5C",
    b"\x01\x03\x02\x21\x21\x60\x0C",
    b"\x01\x03\x02\x22\x22\x20\xFD",
    b"\x01\x03\x02\x23\x23\xE0\xAD",
    b"\x01\x03\x02\x24\x24\xA3\x5F",
    b"\x01\x03\x02\x25\x25\x63\x0F",
    b"\x01\x03\x02\x26\x26\x23\xFE",
    b"\x01\x03\x02\x27\x27\xE3\xAE",
    b"\x01\x03\x02\x28\x28\xA6\x5A",
    b"\x01\x03\x02\x29\x29\x66\x0A",
    b"\x01\x03\x02\x2A\x2A\x26\xFB",
    b"\x01\x03\x02\x2B\x2B\xE6\xAB",
    b"\x01\x03\x02\x2C\x2C\xA5\x59",
    b"\x01\x03\x02\x2D\x2D\x65\x09",
    b"\x01\x03\x02\x2E\x2E\x25\xF8",
    b"\x01\x03\x02\x2F\x2F\xE5\xA8",
    b"\x01\x03\x02\x30\x30\xAC\x50",
    b"\x01\x03\x02\x31\x31\x6C\x00",
    b"\x01\x03\x02\x32\x32\x2C\xF1",
    b"\x01\x03\x02\x33\x33\xEC\xA1",
    b"\x01\x03\x02\x34\x34\xAF\x53",
    b"\x01\x03\x02\x35\x35\x6F\x03",
    b"\x01\x03\x02\x36\x36\x2F\xF2",
    b"\x01\x03\x02\x37\x37\xEF\xA2",
    b"\x01\x03\x02\x38\x38\xAA\x56",
    b"\x01\x03\x02\x39\x39\x6A\x06",
    b"\x01\x03\x02\x3A\x3A\x2A\xF7",
    b"\x01\x03\x02\x3B\x3B\xEA\xA7",
    b"\x01\x03\x02\x3C\x3C\xA9\x55",
    b"\x01\x03\x02\x3D\x3D\x69\x05",
    b"\x01\x03\x02\x3E\x3E\x29\xF4",
    b"\x01\x03\x02\x3F\x3F\xE9\xA4",
    b"\x01\x03\x02\x40\x40\x88\x74",
    b"\x01\x03\x02\x41\x41\x48\x24",
    b"\x01\x03\x02\x42\x42\x08\xD5",
    b"\x01\x03\x02\x43\x43\xC8\x85",
    b"\x01\x03\x02\x44\x44\x8B\x77",
    b"\x01\x03\x02\x45\x45\x4B\x27",
    b"\x01\x03\x02\x46\x46\x0B\xD6",
    b"\x01\x03\x02\x47\x47\xCB\x86",
    b"\x01\x03\x02\x48\x48\x8E\x72",
    b"\x01\x03\x02\x49\x49\x4E\x22",
    b"\x01\x03\x02\x4A\x4A\x0E\xD3",
    b"\x01\x03\x02\x4B\x4B\xCE\x83",
    b"\x01\x03\x02\x4C\x4C\x8D\x71",
    b"\x01\x03\x02\x4D\x4D\x4D\x21",
    b"\x01\x03\x02\x4E\x4E\x0D\xD0",
    b"\x01\x03\x02\x4F\x4F\xCD\x80",
    b"\x01\x03\x02\x50\x50\x84\x78",
    b"\x01\x03\x02\x51\x51\x44\x28",
    b"\x01\x03\x02\x52\x52\x04\xD9",
    b"\x01\x03\x02\x53\x53\xC4\x89",
    b"\x01\x03\x02\x54\x54\x87\x7B",
    b"\x01\x03\x02\x55\x55\x47\x2B",
    b"\x01\x03\x02\x56\x56\x07\xDA",
    b"\x01\x03\x02\x57\x57\xC7\x8A",
    b"\x01\x03\x02\x58\x58\x82\x7E",
    b"\x01\x03\x02\x59\x59\x42\x2E",
    b"\x01\x03\x02\x5A\x5A\x02\xDF",
    b"\x01\x03\x02\x5B\x5B\xC2\x8F",
    b"\x01\x03\x02\x5C\x5C\x81\x7D",
    b"\x01\x03\x02\x5D\x5D\x41\x2D",
    b"\x01\x03\x02\x5E\x5E\x01\xDC",
    b"\x01\x03\x02\x5F\x5F\xC1\x8C",
    b"\x01\x03\x02\x60\x60\x90\x6C",
    b"\x01\x03\x02\x61\x61\x50\x3C",
    b"\x01\x03\x02\x62\x62\x10\xCD",
    b"\x01\x03\x02\x63\x63\xD0\x9D",
    b"\x01\x03\x02\x64\x64\x93\x6F",
    b"\x01\x03\x02\x65\x65\x53\x3F",
    b"\x01\x03\x02\x66\x66\x13\xCE",
    b"\x01\x03\x02\x67\x67\xD3\x9E",
    b"\x01\x03\x02\x68\x68\x96\x6A",
    b"\x01\x03\x02\x69\x69\x56\x3A",
    b"\x01\x03\x02\x6A\x6A\x16\xCB",
    b"\x01\x03\x02\x6B\x6B\xD6\x9B",
    b"\x01\x03\x02\x6C\x6C\x95\x69",
    b"\x01\x03\x02\x6D\x6D\x55\x39",
    b"\x01\x03\x02\x6E\x6E\x15\xC8",
    b"\x01\x03\x02\x6F\x6F\xD5\x98",
    b"\x01\x03\x02\x70\x70\x9C\x60",
    b"\x01\x03\x02\x71\x71\x5C\x30",
    b"\x01\x03\x02\x72\x72\x1C\xC1",
    b"\x01\x03\x02\x73\x73\xDC\x91",
    b"\x01\x03\x02\x74\x74\x9F\x63",
    b"\x01\x03\x02\x75\x75\x5F\x33",
    b"\x01\x03\x02\x76\x76\x1F\xC2",
    b"\x01\x03\x02\x77\x77\xDF\x92",
    b"\x01\x03\x02\x78\x78\x9A\x66",
    b"\x01\x03\x02\x79\x79\x5A\x36",
    b"\x01\x03\x02\x7A\x7A\x1A\xC7",
    b"\x01\x03\x02\x7B\x7B\xDA\x97",
    b"\x01\x03\x02\x7C\x7C\x99\x65",
    b"\x01\x03\x02\x7D\x7D\x59\x35",
    b"\x01\x03\x02\x7E\x7E\x19\xC4",
    b"\x01\x03\x02\x7F\x7F\xD9\x94",
    b"\x01\x03\x02\x80\x80\xD8\x24",
    b"\x01\x03\x02\x81\x81\x18\x74",
    b"\x01\x03\x02\x82\x82\x58\x85",
    b"\x01\x03\x02\x83\x83\x98\xD5",
    b"\x01\x03\x02\x84\x84\xDB\x27",
    b"\x01\x03\x02\x85\x85\x1B\x77",
    b"\x01\x03\x02\x86\x86\x5B\x86",
    b"\x01\x03\x02\x87\x87\x9B\xD6",
    b"\x01\x03\x02\x88\x88\xDE\x22",
    b"\x01\x03\x02\x89\x89\x1E\x72",
    b"\x01\x03\x02\x8A\x8A\x5E\x83",
    b"\x01\x03\x02\x8B\x8B\x9E\xD3",
    b"\x01\x03\x02\x8C\x8C\xDD\x21",
    b"\x01\x03\x02\x8D\x8D\x1D\x71",
    b"\x01\x03\x02\x8E\x8E\x5D\x80",
    b"\x01\x03\x02\x8F\x8F\x9D\xD0",
    b"\x01\x03\x02\x90\x90\xD4\x28",
    b"\x01\x03\x02\x91\x91\x14\x78",
    b"\x01\x03\x02\x92\x92\x54\x89",
    b"\x01\x03\x02\x93\x93\x94\xD9",
    b"\x01\x03\x02\x94\x94\xD7\x2B",
    b"\x01\x03\x02\x95\x95\x17\x7B",
    b"\x01\x03\x02\x96\x96\x57\x8A",
    b"\x01\x03\x02\x97\x97\x97\xDA",
    b"\x01\x03\x02\x98\x98\xD2\x2E",
    b"\x01\x03\x02\x99\x99\x12\x7E",
    b"\x01\x03\x02\x9A\x9A\x52\x8F",
    b"\x01\x03\x02\x9B\x9B\x92\xDF",
    b"\x01\x03\x02\x9C\x9C\xD1\x2D",
    b"\x01\x03\x02\x9D\x9D\x11\x7D",
    b"\x01\x03\x02\x9E\x9E\x51\x8C",
    b"\x01\x03\x02\x9F\x9F\x91\xDC",
    b"\x01\x03\x02\xA0\xA0\xC0\x3C",
    b"\x01\x03\x02\xA1\xA1\x00\x6C",
    b"\x01\x03\x02\xA2\xA2\x40\x9D",
    b"\x01\x03\x02\xA3\xA3\x80\xCD",
    b"\x01\x03\x02\xA4\xA4\xC3\x3F",
    b"\x01\x03\x02\xA5\xA5\x03\x6F",
    b"\x01\x03\x02\xA6\xA6\x43\x9E",
    b"\x01\x03\x02\xA7\xA7\x83\xCE",
    b"\x01\x03\x02\xA8\xA8\xC6\x3A",
    b"\x01\x03\x02\xA9\xA9\x06\x6A",
    b"\x01\x03\x02\xAA\xAA\x46\x9B",
    b"\x01\x03\x02\xAB\xAB\x86\xCB",
    b"\x01\x03\x02\xAC\xAC\xC5\x39",
    b"\x01\x03\x02\xAD\xAD\x05\x69",
    b"\x01\x03\x02\xAE\xAE\x45\x98",
    b"\x01\x03\x02\xAF\xAF\x85\xC8",
    b"\x01\x03\x02\xB0\xB0\xCC\x30",
    b"\x01\x03\x02\xB1\xB1\x0C\x60",
    b"\x01\x03\x02\xB2\xB2\x4C\x91",
    b"\x01\x03\x02\xB3\xB3\x8C\xC1",
    b"\x01\x03\x02\xB4\xB4\xCF\x33",
    b"\x01\x03\x02\xB5\xB5\x0F\x63",
    b"\x01\x03\x02\xB6\xB6\x4F\x92",
    b"\x01\x03\x02\xB7\xB7\x8F\xC2",
    b"\x01\x03\x02\xB8\xB8\xCA\x36",
    b"\x01\x03\x02\xB9\xB9\x0A\x66",
    b"\x01\x03\x02\xBA\xBA\x4A\x97",
    b"\x01\x03\x02\xBB\xBB\x8A\xC7",
    b"\x01\x03\x02\xBC\xBC\xC9\x35",
    b"\x01\x03\x02\xBD\xBD\x09\x65",
    b"\x01\x03\x02\xBE\xBE\x49\x94",
    b"\x01\x03\x02\xBF\xBF\x89\xC4",
    b"\x01\x03\x02\xC0\xC0\xE8\x14",
    b"\x01\x03\x02\xC1\xC1\x28\x44",
    b"\x01\x03\x02\xC2\xC2\x68\xB5",
    b"\x01\x03\x02\xC3\xC3\xA8\xE5",
    b"\x01\x03\x02\xC4\xC4\xEB\x17",
    b"\x01\x03\x02\xC5\xC5\x2B\x47",
    b"\x01\x03\x02\xC6\xC6\x6B\xB6",
    b"\x01\x03\x02\xC7\xC7\xAB\xE6",
    b"\x01\x03\x02\xC8\xC8\xEE\x12",
    b"\x01\x03\x02\xC9\xC9\x2E\x42",
    b"\x01\x03\x02\xCA\xCA\x6E\xB3",
    b"\x01\x03\x02\xCB\xCB\xAE\xE3",
    b"\x01\x03\x02\xCC\xCC\xED\x11",
    b"\x01\x03\x02\xCD\xCD\x2D\x41",
    b"\x01\x03\x02\xCE\xCE\x6D\xB0",
    b"\x01\x03\x02\xCF\xCF\xAD\xE0",
    b"\x01\x03\x02\xD0\xD0\xE4\x18",
    b"\x01\x03\x02\xD1\xD1\x24\x48",
    b"\x01\x03\x02\xD2\xD2\x64\xB9",
    b"\x01\x03\x02\xD3\xD3\xA4\xE9",
    b"\x01\x03\x02\xD4\xD4\xE7\x1B",
    b"\x01\x03\x02\xD5\xD5\x27\x4B",
    b"\x01\x03\x02\xD6\xD6\x67\xBA",
    b"\x01\x03\x02\xD7\xD7\xA7\xEA",
    b"\x01\x03\x02\xD8\xD8\xE2\x1E",
    b"\x01\x03\x02\xD9\xD9\x22\x4E",
    b"\x01\x03\x02\xDA\xDA\x62\xBF",
    b"\x01\x03\x02\xDB\xDB\xA2\xEF",
    b"\x01\x03\x02\xDC\xDC\xE1\x1D",
    b"\x01\x03\x02\xDD\xDD\x21\x4D",
    b"\x01\x03\x02\xDE\xDE\x61\xBC",
    b"\x01\x03\x02\xDF\xDF\xA1\xEC",
    b"\x01\x03\x02\xE0\xE0\xF0\x0C",
    b"\x01\x03\x02\xE1\xE1\x30\x5C",
    b"\x01\x03\x02\xE2\xE2\x70\xAD",
    b"\x01\x03\x02\xE3\xE3\xB0\xFD",
    b"\x01\x03\x02\xE4\xE4\xF3\x0F",
    b"\x01\x03\x02\xE5\xE5\x33\x5F",
    b"\x01\x03\x02\xE6\xE6\x73\xAE",
    b"\x01\x03\x02\xE7\xE7\xB3\xFE",
    b"\x01\x03\x02\xE8\xE8\xF6\x0A",
    b"\x01\x03\x02\xE9\xE9\x36\x5A",
    b"\x01\x03\x02\xEA\xEA\x76\xAB",
    b"\x01\x03\x02\xEB\xEB\xB6\xFB",
    b"\x01\x03\x02\xEC\xEC\xF5\x09",
    b"\x01\x03\x02\xED\xED\x35\x59",
    b"\x01\x03\x02\xEE\xEE\x75\xA8",
    b"\x01\x03\x02\xEF\xEF\xB5\xF8",
    b"\x01\x03\x02\xF0\xF0\xFC\x00",
    b"\x01\x03\x02\xF1\xF1\x3C\x50",
    b"\x01\x03\x02\xF2\xF2\x7C\xA1",
    b"\x01\x03\x02\xF3\xF3\xBC\xF1",
    b"\x01\x03\x02\xF4\xF4\xFF\x03",
    b"\x01\x03\x02\xF5\xF5\x3F\x53",
    b"\x01\x03\x02\xF6\xF6\x7F\xA2",
    b"\x01\x03\x02\xF7\xF7\xBF\xF2",
    b"\x01\x03\x02\xF8\xF8\xFA\x06",
    b"\x01\x03\x02\xF9\xF9\x3A\x56",
    b"\x01\x03\x02\xFA\xFA\x7A\xA7",
    b"\x01\x03\x02\xFB\xFB\xBA\xF7",
    b"\x01\x03\x02\xFC\xFC\xF9\x05",
    b"\x01\x03\x02\xFD\xFD\x39\x55",
    b"\x01\x03\x02\xFE\xFE\x79\xA4",
    b"\x01\x03\x02\xFF\xFF\xB9\xF4"
]

import socket
import serial
import time
import binascii


def send_one(offset: int, mode, net_sock: socket.SocketType, ser_han: serial.Serial):

    request = REQ_DATA[offset]
    net_sock.send(request)
    time.sleep(0.1)

    expect = request

    if mode is not None:
        # then conversion
        mode = mode.lower()

        if mode == 'CR':
            # make the Modbus request with NL replaced by CR
            expect = request.replace(b'\x0A', b'\x0D')

        elif mode == 'NL':
            # make the Modbus request with CR replaced by NL
            expect = request.replace(b'\x0D', b'\x0A')

        else:  # assume CR/NL - here a slight cheat, as we know none of the Modbus source have both CR & NL
            if request.find(b'\x0A') >= 0:
                # print("Do NL replace")
                expect = request.replace(b'\x0A', b'\x0D\x0A')
            elif request.find(b'\x0D') >= 0:
                # print("Do CR replace")
                expect = request.replace(b'\x0D', b'\x0D\x0A')

    response = ser_han.read(size=1024)
    print("%03d:result:%s" % (offset, binascii.hexlify(response)))
    if expect != response:
        print("    ERROR :{0}".format(binascii.hexlify(expect)))
        return 1

    # was okay, so send the reply
    reply = RSP_DATA[offset]
    ser_han.write(reply)
    time.sleep(0.1)

    # no modifications in the serial to NET direction
    expect = reply

    try:
        response = net.recv(1024)
        print("    serial:%s" % binascii.hexlify(response))
        if expect != response:
            print("    ERROR :{0}".format(binascii.hexlify(expect)))
            return 1

    except socket.timeout:
        print("See:None")
        return 1

    return 0


if __name__ == '__main__':

    net = socket.socket()
    host = "192.168.0.208"
    port = 7218
    net.connect((ROUTER_IP, ROUTER_PORT))
    net.settimeout(0.25)
    ser = serial.Serial(SERIAL_PORT, timeout=0.25)

    errors = 0
    for x in range(0, 256):
        errors += send_one(x, LINE_FEED, net_sock=net, ser_han=ser)

    net.close()
    ser.close()

    if errors == 0:
        print("Results all as expected")
    else:
        print("ERROR: %d packets not as expected" % errors)
